# Yet Another WordPress boilerplate

Этот репозиторий предназначен для быстрого старта разработки нового WordPress сайта. 
Важные фичи
- добавлен докер - можно удобнее разрабатывать сайт локально с его помощью
- в композере добавлена тема Bootscore - хорошая начальная точка разработки собственной темы на Bootstrap
- добавлены и готовы к работе плагины WP Super Cache, Redis Cache, S3-Uploads

В сборке нет WooCommerce, потому что он нужен не для всех сайтов.
Чтобы установить плагин WooCommerce введите эту команду в папке проекта

```
composer require wpackagist-plugin/woocommerce
```

## В планах
- доработать докеризацию (добавить Redis образ, добавить docker watch вместо подключения папки)
- добавить ci/cd конвеер для развертывания сборки

## Установка

0. Убедиться что установлена программа `composer`. Это менеджер пакетов и зависимостей для разных PHP и не только библиотек, плагинов и т.д. Инструкция по установке - https://getcomposer.org/download/
1. Создать папку проекта и скачать туда файлы этого репозитория.
2. Сделать `git commit -m 'init commit'` в ваш собственный репозиторий проекта. 
3. Запустить команду 
```
composer update
```

Можно начинать разработку.

## Развернуть сайт локально для разработки с помощью Docker

1. Прописать следующие .env переменные таким образом:

```
DB_NAME='bedrock'
DB_HOST='db'
WP_ENV='development'
WP_HOME='http://localhost/'
SITENAME='sitename'

```
2. Установить все пакеты через composer
3. Запустить `docker compose up -d` - сайт будет доступен по адресу http://localhost/

Если нужно импортировать базу данных:
В папку /dump положить .sql дамп базы данных и выполнить следующую команду (docker должен быть поднят)

```
docker exec -i mysql mysql -uroot -pexample_password bedrock < dump/database_bump_file.sql
```

### Если возникла ошибка с доступом к файлам на Linux

1. Нужно запустить контейнеры `docker compose up -d`, затем зайти в контейнер командой `docker exec -it wordpress bash`
2. Командой `ls -la` смотрим листинг папок и файлов проекта, скорее всего там будет пользователь root в группе root
3. Попробуйте следующей командой изменить владение каким-то файлом `chown 1000:1000 wp-cli.yml`
4. Теперь уже у себя (не в докере) посмотрите кому принадлежит теперь файл командой `ls -la` и если теперь это пользователь 100999, то нужно сделать следующее:

```
sudo addgroup dockerdesktop
sudo groupmod -g 100999 dockerdesktop
sudo usermod -aG dockerdesktop <your hostuser>
newgrp
```
затем

```
chmod -R g+wx <projectfolder>
sudo chgrp -R dockerdesktop <projectfolder>
```

## Обновить (задеплоить) сайт на сервере

Если все верно первично настроено на хостинге, то можно пользоваться sh-скриптом чтобы не обновлять сайт вручную.
Для этого из корневой папки сайта запустить ``./deploy.sh``
Что делает скрипт:
- получит свежий код из текущей ветки
- обновит композер
- обновит переводы Wordpress и всех плагинов
- принудительно установит окружение на 'production'

Если скрипт не запускается, выполнить команду ``chmod u+x deploy.sh``

## Настройка плагина WP Super Cache

Не отмечать в настройках Enable dynamic caching (или проверить работоспособность сайта после отметки)

Можно использовать следующую подробную инструкцию:
https://onlinemediamasters.com/wp-super-cache-settings/

## Настройка плагина Redis Object Cache

Redis - возможнось хранить часть базы данных сайта в оперативной памяти для более быстрого доступа к ней. Ускоряет работу сайта, особенно если на нем есть Woocommerce (этот плагин даже выдает предупреждение если Redis не настроен).

Прописать настройки в .env файле - важно указать сайту уникальный идентификатор (WP_REDIS_PREFIX), можно например воспользоваться любым генератором паролей. Затем активировать плагин и запустить в настройках Redis. HOST и PORT обычно такие как уже указано в .env.example.

Важно: Redis должен быть установлен и настроен на сервере в первую очередь. На хостинге его может совсем не быть или это может быть дополнительная услуга.

### Обновление

Обновления от 23 ноября 2024
- обновил версию WordPress до 6.7.2
- backup тема теперь twentytwentyfive
